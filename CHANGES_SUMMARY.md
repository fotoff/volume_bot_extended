# üìã –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–æ—Ç–µ v2

## üÜï –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. TTL –¥–ª—è SELL –æ—Ä–¥–µ—Ä–æ–≤ (30 –¥–Ω–µ–π)
- **–§–∞–π–ª**: `config.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω `SELL_TTL_SECONDS = 30 * 24 * 60 * 60` (30 –¥–Ω–µ–π)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: SELL –æ—Ä–¥–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ TTL

### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è PnL –∑–∞—â–∏—Ç–∞
- **–§–∞–π–ª**: `extended-bot-v2.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `target <= branch_wap` –ø–µ—Ä–µ–¥ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º SELL
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: SELL –æ—Ä–¥–µ—Ä–∞ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—ã—à–µ WAP (Weighted Average Price) –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —É–±—ã—Ç–∫–æ–≤

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—Ä–∞–∑–º–µ—â–µ–Ω–∏–µ SELL –æ—Ä–¥–µ—Ä–æ–≤
- **–§–∞–π–ª**: `extended-bot-v2.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `check_sell_ttls()` –∏ –µ—ë –≤—ã–∑–æ–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç TTL SELL –æ—Ä–¥–µ—Ä–æ–≤ –∏ –ø–µ—Ä–µ—Ä–∞–∑–º–µ—â–∞–µ—Ç –∏—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
# –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ SELL –æ—Ä–¥–µ—Ä–æ–≤ (30 –¥–Ω–µ–π –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
# SELL –æ—Ä–¥–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ TTL
SELL_TTL_SECONDS = 30 * 24 * 60 * 60  # 30 –¥–Ω–µ–π

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å (PnL –∑–∞—â–∏—Ç–∞): –Ω–µ –Ω–∏–∂–µ WAP +0.05%
# SELL –æ—Ä–¥–µ—Ä–∞ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—ã—à–µ WAP –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —É–±—ã—Ç–∫–æ–≤
PNL_MIN_PCT = 0.0005
```

### –õ–æ–≥–∏–∫–∞ PnL –∑–∞—â–∏—Ç—ã
```python
# PnL –∑–∞—â–∏—Ç–∞: —Å–µ–ª–ª –æ—Ä–¥–µ—Ä–∞ —Ç–æ–ª—å–∫–æ –≤—ã—à–µ WAP
target = b.buy_price * (Decimal("1") + leg.target_pct)
if target <= branch_wap:
    self.log(symbol, f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º {leg_name} - target {target} <= WAP {branch_wap}")
    continue
```

### TTL –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–µ—Ä–µ—Ä–∞–∑–º–µ—â–µ–Ω–∏–µ
```python
async def check_sell_ttls(self, symbol: str):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç TTL —Å–µ–ª–ª –æ—Ä–¥–µ—Ä–æ–≤ –∏ –ø–µ—Ä–µ—Ä–∞–∑–º–µ—â–∞–µ—Ç –∏—Ö –µ—Å–ª–∏ –Ω—É–∂–Ω–æ"""
    # ... –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ TTL
    if order_age > SELL_TTL_SECONDS:
        # –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—ã–π –æ—Ä–¥–µ—Ä –∏ –ø–µ—Ä–µ—Ä–∞–∑–º–µ—â–∞–µ–º —Å –Ω–æ–≤—ã–º TTL
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

1. **SELL –æ—Ä–¥–µ—Ä–∞ —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç TTL 30 –¥–Ω–µ–π** –≤–º–µ—Å—Ç–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏
2. **PnL –∑–∞—â–∏—Ç–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç**, —á—Ç–æ SELL –æ—Ä–¥–µ—Ä–∞ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–±—ã–ª—å–Ω–æ–π –∑–æ–Ω–µ (–≤—ã—à–µ WAP)
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—Ä–∞–∑–º–µ—â–µ–Ω–∏–µ** SELL –æ—Ä–¥–µ—Ä–æ–≤ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ TTL
4. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ PnL –∑–∞—â–∏—Ç–µ –∏ TTL

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞: `systemctl stop extended-bot-rise`
2. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã: `config.py` –∏ `extended-bot-v2.py`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: `systemctl start extended-bot-rise`
